<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心雲基金會 - 管理後台</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&family=Source+Sans+3:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --sidebar-width: 260px;
        }

        body {
            background-color: #f0f4f8;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: white;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }

        .sidebar-header {
            padding: 2rem;
            border-bottom: 1px solid var(--border);
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.25rem;
        }

        .sidebar-menu {
            flex: 1;
            padding: 1.5rem 0;
        }

        .menu-item {
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-muted);
            text-decoration: none;
            transition: all 0.2s;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .menu-item:hover,
        .menu-item.active {
            color: var(--primary);
            background-color: rgba(8, 145, 178, 0.05);
            border-left-color: var(--primary);
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 2.5rem;
        }

        .content-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
                z-index: 1000;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1.5rem;
                padding-top: 5rem;
                /* Space for mobile header */
            }

            .mobile-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 1rem 1.5rem;
                background: white;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 900;
                border-bottom: 1px solid var(--border);
                box-shadow: var(--shadow-sm);
            }

            .overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 950;
            }

            .overlay.active {
                display: block;
            }
        }

        @media (min-width: 769px) {

            .mobile-header,
            .overlay {
                display: none !important;
            }
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            background: none;
            min-height: auto;
            border: none;
            padding: 0;
            text-align: left;
        }

        .page-header h2 {
            margin: 0;
            color: var(--text);
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .input-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-family: inherit;
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th {
            text-align: left;
            padding: 1rem;
            background: #f8fafc;
            border-bottom: 2px solid var(--border);
            font-weight: 600;
            color: var(--text-muted);
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        .action-btn {
            padding: 0.5rem;
            border-radius: 0.4rem;
            cursor: pointer;
            border: none;
            background: none;
            color: var(--text-muted);
            transition: color 0.2s;
        }

        .action-btn:hover {
            color: var(--primary);
        }

        .delete-btn:hover {
            color: #ef4444;
        }

        .badge {
            padding: 0.25rem 0.6rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            background: rgba(8, 145, 178, 0.1);
            color: var(--primary);
        }

        /* Modal Simulation */
        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }
    </style>
</head>

<body>
    <!-- 導訪驗證 -->
    <script>
        if (sessionStorage.getItem('isAdmin') !== 'true') {
            window.location.href = 'login.html';
        }
    </script>

    <!-- Mobile Header -->
    <div class="mobile-header">
        <div style="font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 0.5rem;">
            <i data-lucide="heart-handshake"></i> 心雲後台
        </div>
        <button onclick="toggleSidebar()"
            style="background: none; border: none; padding: 0.5rem; cursor: pointer; color: var(--text);">
            <i data-lucide="menu"></i>
        </button>
    </div>

    <div class="overlay" onclick="toggleSidebar()"></div>

    <aside class="sidebar">
        <div class="sidebar-header">
            <i data-lucide="heart-handshake"></i> 心雲後台
        </div>
        <nav class="sidebar-menu">
            <div class="menu-item active" onclick="switchSection('news'); toggleSidebarIfMobile();">
                <i data-lucide="bell"></i> 最新消息管理
            </div>
            <div class="menu-item" onclick="switchSection('stories'); toggleSidebarIfMobile();">
                <i data-lucide="map-pin"></i> 愛心足跡管理
            </div>
            <a href="index.html" class="menu-item"
                style="margin-top: auto; border-top: 1px solid var(--border); color: #ef4444;">
                <i data-lucide="log-out"></i> 登出並返回首頁
            </a>
        </nav>
    </aside>

    <main class="main-content">
        <!-- Prototype Warning Banner -->
        <div
            style="background: #fff7ed; color: #9a3412; padding: 1rem; border-radius: var(--radius); margin-bottom: 2rem; font-size: 0.875rem; border: 1px solid #ffedd5; display: flex; align-items: center; gap: 0.75rem;">
            <i data-lucide="alert-triangle" size="20"></i>
            <div>
                <strong>管理系統演示中</strong>：此後台資料僅儲存於您的瀏覽器快取 (Local Storage)。切換瀏覽器或清除快取後資料將重置。
            </div>
        </div>

        <!-- 最新消息管理 -->
        <div id="news-section" class="admin-section active">
            <div class="page-header">
                <h2>最新消息管理</h2>
                <button class="btn btn-primary" onclick="showForm('news')">+ 新增消息</button>
            </div>

            <div id="news-form-container" class="content-card" style="display: none;">
                <h3 class="mb-6">發布新消息</h3>
                <form id="newsForm">
                    <div class="form-grid">
                        <div class="input-group">
                            <label>消息標題</label>
                            <input type="text" id="newsTitle" class="input-control" required>
                        </div>
                        <div class="input-group">
                            <label>發布日期</label>
                            <input type="date" id="newsDate" class="input-control" required>
                        </div>
                        <div class="input-group">
                            <label>分類標籤</label>
                            <select id="newsCategory" class="input-control">
                                <option>活動快訊</option>
                                <option>服務成果</option>
                                <option>急難週報</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>文章摘要 (顯示於列表)</label>
                            <input type="text" id="newsSummary" class="input-control" required>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>詳細內容</label>
                        <textarea id="newsContent" class="input-control" rows="8"
                            placeholder="請輸入完整的消息內容..."></textarea>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="hideForm('news')">取消</button>
                        <button type="submit" class="btn btn-primary">確認發布</button>
                    </div>
                </form>
            </div>

            <div class="content-card">
                <table>
                    <thead>
                        <tr>
                            <th>日期</th>
                            <th>標題</th>
                            <th>分類</th>
                            <th>縮略內容</th>
                            <th style="width: 100px;">操作</th>
                        </tr>
                    </thead>
                    <tbody id="newsTableBody">
                        <!-- 動態內容點 -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 愛心足跡管理 -->
        <div id="stories-section" class="admin-section">
            <div class="page-header">
                <h2>愛心足跡管理</h2>
                <button class="btn btn-primary" onclick="showForm('stories')">+ 新增服務故事</button>
            </div>

            <div id="stories-form-container" class="content-card" style="display: none;">
                <h3 class="mb-6">新增服務故事</h3>
                <form id="storiesForm">
                    <div class="form-grid">
                        <div class="input-group">
                            <label>故事標題</label>
                            <input type="text" id="storyTitle" class="input-control" required>
                        </div>
                        <div class="input-group">
                            <label>服務地點</label>
                            <input type="text" id="storyLocation" class="input-control" placeholder="例如：台東、南投" required>
                        </div>
                        <div class="input-group">
                            <label>服務分類</label>
                            <select id="storyCategory" class="input-control">
                                <option>弱勢關懷</option>
                                <option>教育推廣</option>
                                <option>醫療照護</option>
                                <option>緊急安置</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>圖片網址 (可用 images/ 目錄下的檔案)</label>
                            <input type="text" id="storyImage" class="input-control" value="images/home.png" required>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>故事摘要 (顯示於列表)</label>
                        <textarea id="storySummary" class="input-control" rows="2" required></textarea>
                    </div>
                    <div class="input-group">
                        <label>故事詳情 (完整文章)</label>
                        <textarea id="storyContent" class="input-control" rows="8"
                            placeholder="請輸入感人的完整服務故事..."></textarea>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="hideForm('stories')">取消</button>
                        <button type="submit" class="btn btn-primary">確認發布</button>
                    </div>
                </form>
            </div>

            <div class="content-card">
                <table>
                    <thead>
                        <tr>
                            <th>地點</th>
                            <th>分類</th>
                            <th>故事標題</th>
                            <th>摘要</th>
                            <th style="width: 100px;">操作</th>
                        </tr>
                    </thead>
                    <tbody id="storiesTableBody">
                        <!-- 動態內容點 -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Detail View Modal -->
    <div id="detailModal" class="overlay"
        style="display: none; align-items: center; justify-content: center; z-index: 2000;">
        <div class="content-card"
            style="max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative;">
            <button onclick="closeDetailModal()"
                style="position: absolute; right: 1rem; top: 1rem; background: none; border: none; cursor: pointer; color: var(--text-muted);">
                <i data-lucide="x" size="24"></i>
            </button>
            <h3 id="modalTitle" class="mb-4" style="padding-right: 2rem;"></h3>
            <div id="modalMeta" style="margin-bottom: 1.5rem; font-size: 0.9rem; color: var(--primary);"></div>
            <div id="modalContent" style="white-space: pre-wrap; line-height: 1.8; color: var(--text);"></div>
        </div>
    </div>

    <script src="js/admin.js"></script>
    <script>
        lucide.createIcons();

        function switchSection(section) {
            document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));

            document.getElementById(`${section}-section`).classList.add('active');
            // Fix: Only add active class to the clicked item in sidebar, simpler logic
            const items = document.querySelectorAll('.menu-item');
            if (section === 'news') items[0].classList.add('active');
            if (section === 'stories') items[1].classList.add('active');
        }

        function showForm(type) {
            document.getElementById(`${type}-form-container`).style.display = 'block';
        }

        function hideForm(type) {
            document.getElementById(`${type}-form-container`).style.display = 'none';
        }

        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('active');
            document.querySelector('.overlay').classList.toggle('active');
        }

        function toggleSidebarIfMobile() {
            if (window.innerWidth <= 768) {
                toggleSidebar();
            }
        }
    </script>
</body>

</html>