<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="心雲基金會致力於關懷弱勢族群與教育推廣，您的每一份支持，都是改變生命的力量。">
    <title>心雲基金會 - 讓愛延續，點亮希望</title>
    <link rel="stylesheet" href="css/style.css?v=1">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&family=Source+Sans+3:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">
                <i data-lucide="heart-handshake" color="var(--primary)"></i>
                心雲基金會
            </a>
            <button class="mobile-toggle" aria-label="Toggle navigation">
                <i data-lucide="menu"></i>
            </button>
            <ul class="nav-menu">
                <li><a href="about.html" class="nav-link">關於心雲</a></li>
                <li><a href="services.html" class="nav-link">服務項目</a></li>
                <li class="dropdown">
                    <a href="blog.html" class="nav-link dropdown-toggle">愛心足跡</a>
                    <ul class="dropdown-menu">
                        <li><a href="stories.html" class="dropdown-item">服務故事</a></li>
                        <li><a href="volunteer-exp.html" class="dropdown-item">志工心得</a></li>
                    </ul>
                </li>
                <li><a href="news.html" class="nav-link">最新消息</a></li>
                <li><a href="contact.html" class="nav-link">聯絡我們</a></li>
                <li><a href="assistance.html" class="btn btn-cta">我需要協助</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="hero-large section text-center parallax-bg"
        style="background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url('images/home.png');">
        <div class="container reveal">
            <div class="hero-content">
                <h1 class="hero-title">讓愛延續，點亮希望</h1>
                <p class="hero-subtitle">
                    心雲基金會致力於關懷弱勢族群與教育推廣，您的每一份支持，都是改變生命的力量。
                </p>
                <div class="hero-actions">
                    <a href="assistance.html" class="btn btn-cta">獲得協助</a>
                    <a href="about.html" class="btn btn-secondary hero-btn-secondary">了解更多</a>
                </div>
            </div>
        </div>
    </header>



    <!-- Impact/Intro Section -->
    <section class="section">
        <div class="container">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                <div class="text-center card reveal reveal-delay-100">
                    <i data-lucide="users" size="48" color="var(--primary)" style="margin-bottom: 1rem;"></i>
                    <h3>弱勢關懷</h3>
                    <p class="text-muted">深入社區，為需要幫助的家庭與個人提供實質的生活支持與陪伴。</p>
                </div>
                <div class="text-center card reveal reveal-delay-200">
                    <i data-lucide="book-open" size="48" color="var(--primary)" style="margin-bottom: 1rem;"></i>
                    <h3>教育推廣</h3>
                    <p class="text-muted">透過教育資源的挹注，縮短城鄉差距，為孩子們許一個充滿希望的未來。</p>
                </div>
                <div class="text-center card reveal reveal-delay-300">
                    <i data-lucide="sun" size="48" color="var(--primary)" style="margin-bottom: 1rem;"></i>
                    <h3>公開透明</h3>
                    <p class="text-muted">財務流向公開透明，每一筆捐款都專款專用，不負所託。</p>
                </div>
            </div>
    </section>

    <!-- Featured Stories Section -->
    <section class="section" style="background-color: #f8fafc;">
        <div class="container">
            <div class="text-center mb-20 reveal">
                <h2 class="mb-4">深入在地，看見改變</h2>
                <p class="text-muted">我們的足跡走遍城市與山林，只為守護那份純粹的希望。</p>
            </div>
            <div id="dynamicHomeStories"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 3rem;">
                <!-- 動態注入內容 -->
            </div>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 從 localStorage 讀取故事
            let storiesData = [];
            try {
                storiesData = JSON.parse(localStorage.getItem('xinyun_stories_data')) || [];
            } catch (e) {
                console.error('Data parse error', e);
            }

            // 如果沒有資料，使用預設資料 (避免首頁空白)
            if (storiesData.length === 0) {
                storiesData = [
                    {
                        location: '新北山區',
                        category: '弱勢關懷',
                        title: '獨居不孤單：林阿嬤的溫暖午餐',
                        summary: '高齡 85 歲的林阿嬤獨自居住在偏遠山區，自從基金會的送餐服務接入後，阿嬤不僅每天能吃到熱騰騰的飯菜，更有志工定期的關懷陪伴，讓山區的寒夜不再漫長...',
                        image: 'images/care_delivery.png'
                    },
                    {
                        location: '屏東偏鄉',
                        category: '教育推廣',
                        title: '翻轉未來的筆記本：小明的數位學習路',
                        summary: '在資源小組的協助下，小明透過基金會提供的數位教室與線上導師，克服了城鄉差距的隔閡。如今的他已能在全國青少年程式競賽中大放異彩...',
                        image: 'images/education_mentor.png'
                    }
                ];
            }

            const container = document.getElementById('dynamicHomeStories');
            if (container) {
                // 只顯示前 2 筆
                const displayStories = storiesData.slice(0, 2);

                container.innerHTML = displayStories.map((item, index) => `
                <div class="card reveal active" style="padding: 0; overflow: hidden; border: none; box-shadow: var(--shadow-md); transition-delay: ${index * 100}ms;">
                    <img src="${item.image}" alt="${item.title}" loading="lazy" style="width: 100%; height: 250px; object-fit: cover;">
                    <div style="padding: 2rem;">
                        <div style="color: var(--primary); font-weight: 600; font-size: 0.875rem; margin-bottom: 0.5rem; display:flex; justify-content:space-between;">
                            ${item.category}
                            <span style="font-size: 0.8rem; color: #94a3b8; font-weight:normal;"><i data-lucide="map-pin" size="12" style="display:inline; margin-right:2px;"></i> ${item.location}</span>
                        </div>
                        <h3 class="mb-3">${item.title}</h3>
                        <p class="text-muted mb-6">${item.summary}</p>
                        <button onclick="showPublicDetail('story', ${index})" aria-label="閱讀更多關於 ${item.title}" style="background:none; border:none; padding:0; cursor:pointer; color: var(--primary); font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">閱讀更多 <i data-lucide="arrow-right" size="16"></i></button>
                    </div>
                </div>

                `).join('');
            }

            // --- News Logic ---
            let newsData = [];
            try {
                const raw = localStorage.getItem('xinyun_news_data');
                if (raw) {
                    newsData = JSON.parse(raw);
                }
            } catch (e) {
                console.error('News data parse error', e);
            }

            // Fallback default data
            if (!newsData || newsData.length === 0) {
                newsData = [
                    { date: '2026/02/15', title: '【活動】「愛在心雲」慈善義賣會 - 讓清寒學子安心就學', category: '活動快訊', summary: '誠摯邀請您參與我們的年度慈善義賣，所得將全數撥入「清寒學生助學基金」，幫助貧困學子減輕經濟負擔...' },
                    { date: '2026/03/01', title: '【公告】偏鄉數位教學與陪伴志工招募中', category: '服務成果', summary: '我們正在招募具備數位專長或熱愛教學的志工，透過遠端系統陪伴孩童成長，跨越地理的限制，傳遞知識的力量...' },
                    { date: '2026/03/20', title: '【講座】高齡社會下如何實踐在地安老專題報告', category: '活動快訊', summary: '邀請資深社工師與醫學專家分享，深入探討現階段獨居長者的照護困局與解決方案，分享社區互助網的成功心法...' }
                ];
            }

            const newsContainer = document.getElementById('dynamicHomeNews');
            if (newsContainer) {
                // Display latest 3 items
                const displayNews = newsData.slice(0, 3);
                newsContainer.innerHTML = displayNews.map((item, index) => `
                    <article class="card reveal active" style="padding: 1.5rem; transition-delay: ${index * 100}ms;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <span style="background-color: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: var(--radius-sm); font-size: 0.75rem;">${item.date}</span>
                            <span style="font-size: 0.8rem; color: var(--primary); font-weight: 500;">${item.category}</span>
                        </div>
                        <h4 class="mb-3" style="font-size: 1.1rem; min-height: 3.3rem; margin-bottom: 0.5rem;">
                            <a href="javascript:void(0)" onclick="showPublicDetail('news', ${index})" style="text-decoration:none; color:inherit;">${item.title}</a>
                        </h4>
                        <p class="text-muted mb-4" style="font-size: 0.9rem;">${item.summary.substring(0, 45)}...</p>
                        <button onclick="showPublicDetail('news', ${index})" style="background:none; border:none; padding:0; cursor:pointer; font-size: 0.85rem; font-weight: 600; display: inline-flex; align-items: center; gap: 0.25rem; color: var(--primary);">閱讀詳情 <i data-lucide="arrow-right" size="14"></i></button>
                    </article>
                `).join('');
            }

            if (window.lucide) lucide.createIcons();
        });

        let lastFocusedElement;

        // 公開版詳情顯示邏輯
        function showPublicDetail(type, index) {
            lastFocusedElement = document.activeElement;
            let data = [];
            if (type === 'story') {
                data = JSON.parse(localStorage.getItem('xinyun_stories_data')) || [
                    { title: '獨居不孤單：林阿嬤的溫暖午餐', category: '弱勢關懷', location: '新北山區', content: '高齡 85 歲的林阿嬤獨自居住在偏遠山區，自從基金會的送餐服務接入後，阿嬤不僅每天能吃到熱騰騰的飯菜，更有志工定期的關懷陪伴。' },
                    { title: '翻轉未來的筆記本：小明的數位學習路', category: '教育推廣', location: '屏東偏鄉', content: '在資源小組的協助下，小明透過基金會提供的數位教室與線上導師，克服了城鄉差距的隔閡。數位學習不僅帶給他知識，更給了他看見世界的窗。' }
                ];
            } else {
                data = JSON.parse(localStorage.getItem('xinyun_news_data')) || [
                    { date: '2026/02/15', title: '【活動】「愛在心雲」慈善義賣會 - 讓清寒學子安心就學', category: '活動快訊', content: '誠摯邀請您參與我們的年度慈善義賣，所得將全數撥入「清寒學生助學基金」，幫助貧困學子減輕經濟負擔。' },
                    { date: '2026/03/01', title: '【公告】偏鄉數位教學與陪伴志工招募中', category: '服務成果', content: '我們正在招募具備數位專長或熱愛教學的志工，透過遠端系統陪伴孩童成長，跨越地理的限制，傳遞知識的力量。' },
                    { date: '2026/03/20', title: '【講座】高齡社會下如何實踐在地安老專題報告', category: '活動快訊', content: '邀請資深社工師與醫學專家分享，深入探討現階段獨居長者的照護困局與解決方案，分享社區互助網的成功心法。' }
                ];
            }

            const item = data[index];
            if (!item) return;

            document.getElementById('publicModalTitle').textContent = item.title;
            document.getElementById('publicModalMeta').textContent = type === 'news'
                ? `${item.date} | ${item.category}`
                : `${item.location} | ${item.category}`;
            document.getElementById('publicModalContent').textContent = item.content || item.summary || '此項目目前沒有詳細內容。';

            document.getElementById('publicDetailModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';

            // Focus the close button for accessibility
            const closeBtn = document.querySelector('#publicDetailModal button');
            if (closeBtn) closeBtn.focus();

            if (window.lucide) lucide.createIcons();
        }

        function closePublicModal() {
            document.getElementById('publicDetailModal').style.display = 'none';
            document.body.style.overflow = '';
            if (lastFocusedElement) {
                lastFocusedElement.focus();
            }
        }

        // Close modal on Escape key and Trap Focus
        document.getElementById('publicDetailModal').addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closePublicModal();
            }
            // Simple focus trap
            if (e.key === 'Tab') {
                const focusableContent = this.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                const firstFocusableElement = focusableContent[0];
                const lastFocusableElement = focusableContent[focusableContent.length - 1];

                if (e.shiftKey) { // if shift key pressed for shift + tab combination
                    if (document.activeElement === firstFocusableElement) {
                        lastFocusableElement.focus();
                        e.preventDefault();
                    }
                } else { // if tab key is pressed
                    if (document.activeElement === lastFocusableElement) {
                        firstFocusableElement.focus();
                        e.preventDefault();
                    }
                }
            }
        });
    </script>
    <!-- Public Detail View Modal -->
    <div id="publicDetailModal" role="dialog" aria-modal="true" aria-labelledby="publicModalTitle"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; z-index: 2000;">
        <div
            style="background: white; max-width: 700px; width: 90%; max-height: 85vh; overflow-y: auto; position: relative; padding: 3rem; border-radius: 1rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);">
            <button onclick="closePublicModal()"
                style="position: absolute; right: 1.5rem; top: 1.5rem; background: #f1f5f9; border: none; cursor: pointer; color: var(--text-muted); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <i data-lucide="x" size="20"></i>
            </button>
            <h2 id="publicModalTitle" style="color: var(--primary); margin-bottom: 1rem; line-height: 1.4;"></h2>
            <div id="publicModalMeta"
                style="margin-bottom: 2rem; font-size: 0.95rem; color: #64748b; font-weight: 500; border-bottom: 1px solid #f1f5f9; padding-bottom: 1rem;">
            </div>
            <div id="publicModalContent"
                style="white-space: pre-wrap; line-height: 2; color: var(--text); font-size: 1.1rem; letter-spacing: 0.02em;">
            </div>
            <div style="margin-top: 3rem; text-align: center;">
                <button onclick="closePublicModal()" class="btn btn-primary"
                    style="padding: 0.75rem 2rem;">關閉視窗</button>
            </div>
        </div>
    </div>

    <!-- Latest News Section -->
    <section class="section">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 5rem;"
                class="reveal">
                <div>
                    <h2 class="mb-2">最新動態</h2>
                    <p class="text-muted" style="margin: 0;">掌握心雲基金會的最新活動與公益快訊。</p>
                </div>
                <!-- Desktop Only Button -->
                <a href="news.html" class="btn btn-secondary desktop-only" style="display: inline-flex;">查看更多消息</a>
                <style>
                    .desktop-only {
                        display: none !important;
                    }

                    @media(min-width: 768px) {
                        .desktop-only {
                            display: inline-flex !important;
                        }
                    }
                </style>
            </div>
            <div id="dynamicHomeNews"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                <!-- 動態注入內容 -->
            </div>
            <!-- Mobile Only Button -->
            <div class="text-center mt-8 reveal mobile-only">
                <a href="news.html" class="btn btn-secondary">查看更多消息</a>
            </div>
            <style>
                .mobile-only {
                    display: block;
                }

                @media(min-width: 768px) {
                    .mobile-only {
                        display: none;
                    }
                }
            </style>
        </div>
    </section>

    <!-- Call to Action -->
    <section class="section text-center" style="background-color: var(--primary); color: white;">
        <div class="container reveal">
            <h2 style="color: white; margin-bottom: 1.5rem;">申請協助，我們與您同行</h2>
            <p style="margin-bottom: 2rem; opacity: 0.9;">
                如果您或身邊的人正遭遇困境，請不要獨自承擔。心雲提供專業的社工媒合與資源媒合。
            </p>
            <a href="assistance.html" class="btn" style="background-color: white; color: var(--primary);">立即申請</a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <div class="logo mb-4">
                        <i data-lucide="heart-handshake"></i> 心雲基金會
                    </div>
                    <p class="text-muted">致力於為社會帶來正向改變，關懷弱勢，推廣教育。</p>
                </div>
                <div class="footer-col">
                    <h4>網站地圖</h4>
                    <ul class="footer-links">
                        <li><a href="about.html">關於心雲</a></li>
                        <li><a href="services.html">服務項目</a></li>
                        <li><a href="news.html">最新消息</a></li>
                        <li><a href="assistance.html">我需要協助</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>聯絡資訊</h4>
                    <ul class="footer-links">
                        <li><i data-lucide="map-pin" size="16" style="display:inline; margin-right:4px;"></i> 台北市信義區...
                        </li>
                        <li><i data-lucide="phone" size="16" style="display:inline; margin-right:4px;"></i> (02)
                            1234-5678</li>
                        <li><i data-lucide="mail" size="16" style="display:inline; margin-right:4px;"></i>
                            info@xinyun.org.tw</li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>關注我們</h4>
                    <div style="display: flex; gap: 1rem;">
                        <a href="#" aria-label="Facebook"><i data-lucide="facebook"></i></a>
                        <a href="#" aria-label="Instagram"><i data-lucide="instagram"></i></a>
                        <a href="#" aria-label="Line"><i data-lucide="message-circle"></i></a>
                    </div>
                </div>
            </div>

            <div class="copyright">
                &copy; 2026 心雲基金會. All rights reserved. | <a href="#">隱私權政策</a> | <a href="login.html"
                    style="color: inherit; opacity: 0.5; text-decoration: none; font-size: 0.9em;">員工專區</a>
            </div>
        </div>
    </footer>

    <!-- Prototype Notice Banner (Moved to tail) -->
    <div class="prototype-notice">
        <div class="container" style="display: flex; align-items: center; justify-content: center; gap: 8px;">
            <i data-lucide="info" size="14"></i>
            <span>專案展示提醒：本網站目前為系統功能測試原型，內容均為虛擬數據。資料採用瀏覽器區域儲存 (Local Storage)。</span>
        </div>
    </div>

    <script src="js/main.js?v=1"></script>
    <script>
        lucide.createIcons();
    </script>
</body>

</html>